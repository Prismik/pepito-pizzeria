extends ../layout

block content
    script(type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true")
    script(type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.min.js")
    script(type="text/javascript" src="/javascripts/gmaps.js")
    

    script.
        $(document).ready(function(){

            var map = new GMaps({
                el: '#map_canvas',
                lat: 45.5000,
                lng: -73.5667,
            });


            $('#locateMeBtn').click(function(){
                map.removeMarkers();
                GMaps.geolocate({
                  success: function(position) {
                    map.setCenter(position.coords.latitude, position.coords.longitude);
                    map.addMarker({
                      lat: position.coords.latitude,
                      lng: position.coords.longitude,
                      title: 'Current location',
                      infoWindow: {
                        content: '<p>Your current location</p>' }
                    });

                    $('span.latitude').html(position.coords.latitude);
                    $('span.longitude').html(position.coords.longitude);

                  },
                  error: function(error) {
                    alert('Geolocation failed: '+error.message);
                  },
                  not_supported: function() {
                    alert("Your browser does not support geolocation");
                  },
                  always: function() {
                    // alert("Done!");
                  }
                });
            });

            $('#sendLocationBtn').click(function(){
                map.removeMarkers();
                GMaps.geocode({
                  address: $('#addressInpt').val(),
                  callback: function(results, status) {
                    if (status == 'OK') {
                      var latlng = results[0].geometry.location;
                      map.setCenter(latlng.lat(), latlng.lng());
                      map.addMarker({
                        lat: latlng.lat(),
                        lng: latlng.lng()
                      });

                      $('span.latitude').html(latlng.lat());
                      $('span.longitude').html(latlng.lng());
                    }
                  }
                });
            });
        });

    h1= "Accept order"

    input(id="addressInpt" placeholder="Address, postal code")
    button(id="sendLocationBtn")= "Send location"
    span="or"
    button(id="locateMeBtn")= "Locate me!"
    div#map_canvas(style= "width:100%; height:200px; margin-top: 10px")

    

    p
      | You are currently at these coordinates: 
      span.latitude
      | ,
      span.longitude